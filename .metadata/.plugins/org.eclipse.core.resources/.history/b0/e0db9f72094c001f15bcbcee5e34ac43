package vending;

public class VendingMachine
{
	public static final int COIN_VALUE = 25;

	protected static final int MAX_VALUE = 1000;
	
	private int totalValue;
	
	private int currentValue;
	
	private Dispenser dispenser;

	public VendingMachine()
	{
		dispenser = new Dispenser();
	}

	public int getCurrentValue()
	{
		return currentValue;
	}
	
	protected int getTotalValue()
	{
		return totalValue;
	}
	
	
	public boolean insertCoin()
	{
		if (currentValue < MAX_VALUE) {
			currentValue += COIN_VALUE;
			System.out.println("One coin has been inserted. Current value is " + currentValue);
			return true;
		} else {
			System.out.println("Max capacity reached (" + MAX_VALUE + "), cannot accept more coins. Either buy something or ask to return your coins");
			return false;
		}
	}

	public int returnCoins()
	{
		if (currentValue == 0) {
			System.out.println("No coins to return");
			return 0;
		} else {
			int returnedCoins = 0;
			System.out.println("Take your " + currentValue + " coins");
			returnedCoins = currentValue;
			currentValue = 0;
			return returnedCoins;
		}
	}
	
	public String listItems()
	{
		int[] items = dispenser.getValidSelection();
		int i = 0;
		StringBuilder sb = new StringBuilder();
		
		sb.append("The available products are: ");
		for (i = 0; i < (items.length - 1); i++) {
			sb.append(items[i]);
			sb.append(", ");
		}
		sb.append(items[i]);
		
		return sb.toString();
	}

	public boolean vendItem(int selection)
	{
		int expense = dispenser.dispense(currentValue, selection);
		if (expense == 0) {
			int coins = (Dispenser.VALUE - currentValue) / VendingMachine.COIN_VALUE;
			System.out.println("Insufficient credit to buy selected product. Enter " + coins  + ((coins == 1) ? " coin" : " coins") + " to buy the selected product and try again");
			return false;
		} else {
			totalValue += expense;
			currentValue -= expense;
			System.out.println("You got the product " + selection + ". Current value = " + currentValue);
			return true;
		}
	}

	
}
